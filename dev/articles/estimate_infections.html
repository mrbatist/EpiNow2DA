<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EpiNow2">
<title>Model definition: estimate_infections() • EpiNow2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model definition: estimate_infections()">
<meta property="og:description" content="EpiNow2">
<meta property="og:image" content="epiforecasts.io/EpiNow2/reference/figures/unnamed-chunk-14-1.png">
<meta property="og:image:alt" content="Example estimates produced by EpiNow2 of the reproduction number, cases by date of infection and cases by date of report">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@seabbs">
<meta name="twitter:site" content="@epiforecasts">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.0.1000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-model-definitions">Model definitions</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-model-definitions">
    <a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a>
    <a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a>
    <a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-case-studies">Case studies</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-case-studies">
    <a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Model definition: estimate_infections()</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/HEAD/vignettes/estimate_infections.Rmd" class="external-link"><code>vignettes/estimate_infections.Rmd</code></a></small>
      <div class="d-none name"><code>estimate_infections.Rmd</code></div>
    </div>

    
    
<p><strong>This is a work in progress. Please consider submitting a PR
to improve it.</strong></p>
<p><code><a href="../reference/estimate_infections.html">estimate_infections()</a></code> supports a range of model
formulation. Here we describe the most commonly used and highlight other
options.</p>
<div class="section level2">
<h2 id="renewal-equation-model">Renewal equation model<a class="anchor" aria-label="anchor" href="#renewal-equation-model"></a>
</h2>
<p>This is the default model and is used when
<code>rt != NULL</code>.</p>
<div class="section level3">
<h3 id="initialisation">Initialisation<a class="anchor" aria-label="anchor" href="#initialisation"></a>
</h3>
<p>The model is initialised prior to the first observed data point by
assuming constant exponential growth for the mean of assumed delays from
infection to case report.</p>
<p><span class="math display">\[\begin{align}
  I_{t} &amp;= I_0 \exp  \left(r t \right)  \\
  I_0 &amp;\sim \mathcal{LN}(\log I_{obs}, 0.2) \\
  r &amp;\sim \mathcal{LN}(r_{obs}, 0.2)
\end{align}\]</span></p>
</div>
<div class="section level3">
<h3 id="within-the-range-of-observations">Within the range of observations<a class="anchor" aria-label="anchor" href="#within-the-range-of-observations"></a>
</h3>
<p>Where <span class="math inline">\(I_{obs}\)</span> and <span class="math inline">\(r_{obs}\)</span> are estimated from the first week
of observed data. For the time window of the observed data infections
are then modelled by weighting previous infections by the generation
time and scaling by the instantaneous reproduction number. These
infections are then convolved to cases by of onset date (<span class="math inline">\(O_t\)</span>) and cases by date of report (<span class="math inline">\(D_t\)</span>) using log-normal delay distributions
(though arbitrary delay distributions can be used this is the most
common formulation). This model can be defined mathematically as
follows,</p>
<p><span class="math display">\[\begin{align}
  \log R_{t} &amp;= \log R_{t-1} + \mathrm{GP}_t \\
  I_t &amp;= R_t \sum_{\tau = 1}^{T_I} w(\tau | \mu_{w}, \sigma_{w})
I_{t - \tau} \\
  O_t &amp;= \sum_{\tau = 0}^{T_O} \xi_{O}(\tau | \mu_{\xi_{O}},
\sigma_{\xi_{O}}) I_{t-\tau} \\
  D_t &amp;= \alpha \sum_{\tau = 0}^{T_D} \xi_{D}(\tau | \mu_{\xi_{D}},
\sigma_{\xi_{D}}) O_{t-\tau} \\
  C_t &amp;\sim \mathrm{NB}\left(\omega_{(t \mod 7)}D_t, \phi\right)
\end{align}\]</span></p>
<p>Where <span class="math inline">\(T_I\)</span> is the maximum
generation time, <span class="math inline">\(T_O\)</span> is the maximum
delay from infection to case onset, <span class="math inline">\(T_D\)</span> is the maximum delay from case onset
to report, and <span class="math inline">\(\alpha\)</span> is the
proportion of cases that are ultimately reported (again note these are
all optional and arbitrary).</p>
<p>The delay distributions are then defined as follows,</p>
<p><span class="math display">\[\begin{align}
     w &amp;\sim \mathcal{Gamma}(\mu_{w}, \sigma_{w}) \\
    \xi_{O} &amp;\sim \mathcal{LogNormal}(\mu_{\xi_{O}},
\sigma_{\xi_{O}}) \\
    \xi_{D} &amp;\sim \mathcal{LogNormal}(\mu_{\xi_{D}},
\sigma_{\xi_{D}})
\end{align}\]</span></p>
<p>This model used the following priors for the observation model</p>
<p><span class="math display">\[\begin{align}
    \frac{\omega}{7} &amp;\sim \mathrm{Dirichlet}(1, 1, 1, 1, 1, 1, 1)
\\
    \phi &amp;\sim \frac{1}{\sqrt{\mathcal{N}(0, 1)}}
\end{align}\]</span></p>
<p><span class="math inline">\(\phi\)</span> is truncated to be greater
than 0 and with <span class="math inline">\(\xi\)</span>, and <span class="math inline">\(w\)</span> normalised to sum to 1. Other priors
are set by the user.</p>
<p><span class="math inline">\(GP_t\)</span> is an approximate Hilbert
space Gaussian process as defined in<span class="citation"><sup>[1]</sup></span> using a Matern 3/2 kernel with a
default boundary factor of 1.5 and basis functions scaled to be 20% of
the number of days fitted. The length scale of the Gaussian process was
given a log-normal prior with a mean of 21 days, and a standard
deviation of 7 days truncated to be greater than 3 days and less than
the length of the time-series. The standard deviation of magnitude of
the Gaussian process was assumed to be 0.1. These settings are all
changeable by the user. In addition the user can opt to make use of a
different generative process or to instead remove the dependency on the
previous value of <span class="math inline">\(R_t\)</span> each of these
options impacts run-time and may alter the best use-case for the
model.</p>
</div>
<div class="section level3">
<h3 id="beyond-the-forecast-horizon">Beyond the forecast horizon<a class="anchor" aria-label="anchor" href="#beyond-the-forecast-horizon"></a>
</h3>
<p>Beyond the forecast horizon (<span class="math inline">\(T\)</span>),
by default, the Gaussian process is assumed to continue. However, here
again there are a range of options. These included fixing transmission
dynamics, and scaling <span class="math inline">\(R_t\)</span> based on
the proportion of the population that remain susceptible. This is
defined as followed,</p>
<p><span class="math display">\[\begin{equation}
    I_t = (N - I^c_{t-1}) \left(1 - \exp \left(\frac{-I'_t}{N -
I^c_{T}}\right)\right),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(I^c_t = \sum_{s&lt; t} I_s\)</span>
are cumulative infections by <span class="math inline">\(t-1\)</span>
and <span class="math inline">\(I'_t\)</span> are the unadjusted
infections defined above. This adjustment is based on the one
implemented in the <code>epidemia</code> R package<span class="citation"><sup>[2]</sup></span>.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-approxGP" class="csl-entry">
1. Riutort-Mayol, G., Bürkner, P.-C., Andersen, M. R., Solin, A., &amp;
Vehtari, A. (2020). <em>Practical hilbert space approximate bayesian
gaussian processes for probabilistic programming</em>. <a href="https://arxiv.org/abs/2004.11408" class="external-link">https://arxiv.org/abs/2004.11408</a>
</div>
<div id="ref-bhattSemiMechanisticBayesianModeling" class="csl-entry">
2. Bhatt, S., Ferguson, N., Flaxman, S., Gandy, A., Mishra, S., &amp;
Scott, J. A. (n.d.). <em>Semi-<span>Mechanistic Bayesian</span> modeling
of <span>COVID-19</span> with <span>Renewal Processes</span></em>. 14.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, EpiForecasts, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
